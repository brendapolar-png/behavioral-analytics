## Data

### Importar librerías
```{r librerias}
#| message: falseu
#| warning: false

library(tidyverse)
library(DataExplorer)
library(samplingbook)
library(survey)
```

Base de datos simulada por el profesor
```{r import-data}
#| message: false

data = read_csv('C:/Users/BRENDA/Documents/GitHub/behavioral-analytics/clase2/data.csv')
```

## Ejercicio 1

### Extrae una muestra representativa de clientes entre 18 y 25 años con ingresos no mayores a S/ 5,000 ¿Cuál es el ingreso promedio de tu muestra? (utiliza margen de error de 0.05, nivel de confianza 0.95, y considera la máxima varianza posible)

Primero, delimitar el público objetivo: clientes entre 18 y 25 años con ingresos no mayores a 5,000

```{r}
poblacion_objetivo <- data %>%
  filter(edad >= 18, edad <= 25, ingreso_mensual <= 5000)
  nrow(poblacion_objetivo)
```

Calcular el tamaño de la muestra

```{r}
N = nrow(poblacion_objetivo)
print(N)

n = sample.size.prop(
    e =  0.05, # margen de error 
    P = 0.5, # proporción de varianza maxima
    N = N, # tamaño de nuestra población o público objetivo
    level = 0.95 # intervalo de confianza
)
print(n)

n = n$n
print(n)
class(n)
```

Extraer muestra aleatoria de data
```{r}
set.seed(1234)
muestra_aleatoria_simple <- poblacion_objetivo %>%
    slice_sample(n = n)

print(muestra_aleatoria_simple)
```

¿Cuál es el ingreso promedio de tu muestra?
```{r}
ingreso_promedio <- mean(muestra_aleatoria_simple$ingreso_mensual)
print(ingreso_promedio)
```

## Ejercicio 2 y 3

### ¿Qué variables predicen los ingresos significativamente, y en cuánto? (usa coeficientes no estandarizados)
### Tomando en cuenta los resultados de tu modelo anterior, ¿qué significa el R2? ¿cómo interpretarías los coeficientes estandarizados?

Preparar variables categóricas
```{r}
data_clean = data %>%
    mutate(
        sexo = factor(sexo, levels = c('F', 'M')),
        region = factor(region, levels = c('Lima', 'Provincia')),
        comportamiento_financiero = factor(comportamiento_financiero, levels = c('Sin deudas', 'Endeudado', 'Sobreendeudado'))
    )
```
 
Regresion lineal multiple
 ```{r regression-analysis}
# Regresión lineal múltiple
model = lm(ingreso_mensual ~ sexo + region + edad + comportamiento_financiero, data = data_clean)
print(summary(model))
```

Interpretación de los resultados:
- R2 de 0,2855. Hay alta variabilidad de los datos (se encuentran dispersos)
- Todas las variables a excepción de Comportamiento Financiero tienen un efecto significativo sobre la variable Ingreso mensual. Es decir, Sexo, Region y Edad, ya que tienen un p-value menor a 0.05. 
- SexoM: Manteniendo las demás variables constantes, ser hombre genera 636 unidades monetarias más en el ingreso mensual que ser mujer
- RegionProvincia: Manteniendo las demás variables constantes, vivir en provincia genera 708 unidades monetarias menos en el ingreso mensual que vivir en Lima
- Edad: Manteniedo las demás variables constantes, cada año adicional de edad genera 57 unidades monetarias más en el ingreso mensual.

Coeficientes estandarizados
```{r standardized-coefficients}
# Calcular coeficientes estandarizados
standardized_model = lm(scale(ingreso_mensual) ~ sexo + region + scale(edad), data = data_clean)
print(tidy(standardized_model))
```